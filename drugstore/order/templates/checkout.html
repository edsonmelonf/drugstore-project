<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Finalizar Compra - Drugstore</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root {
      --red: #e81010;
      --muted: #7a7a7a;
      --bg: #fafafa;
      --card: #fff;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: #111; }
    .site { max-width: 900px; margin: 28px auto; padding: 0 18px; }
    .header { display: flex; align-items: center; gap: 12px; padding: 18px 0; }
    .brand { font-weight: 800; color: var(--red); font-size: 20px; }
    .panel { background: var(--card); padding: 16px; border-radius: 10px; margin-bottom: 18px; }
    .checkout-grid { display: grid; grid-template-columns: 1fr 320px; gap: 18px; }
    .checkout-list { max-height: 420px; overflow: auto; }
    label { display: block; margin-top: 8px; }
    input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
    .btn { padding: 10px 12px; border-radius: 8px; border: 0; background: var(--red); color: #fff; cursor: pointer; }
    .btn.outline { background: #fff; color: var(--red); border: 1px solid var(--red); }
    .muted { color: var(--muted); }
    @media(max-width: 900px) { .checkout-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="site">
    <header class="header">
      <a class="brand" href="{% url 'store:home' %}">DRUGSTORE</a>
      <div style="flex:1"></div>
      <a class="btn outline" href="{% url 'cart:cart' %}">Voltar ao carrinho</a>
    </header>

    <h2>Finalizar Compra</h2>

    <div class="checkout-grid">

      <form action="{% url 'order:place_order' %}" method="post" class="panel" id="checkoutForm">
        {% csrf_token %}
      
        <label for="full_name">Nome completo</label>
        <input id="full_name" name="full_name" required value="">

        <label for="phone">Telefone</label>
        <input type="text" name="phone" maxlength="11" required>

        <label for="address">Endereço</label>
        <input id="address" name="address" required value="">

        <h4 style="margin-top:12px">Pagamento</h4>
        <label for="payment_method">Forma</label>
        <select id="payment_method" name="payment_method">
          <option value="pix">PIX</option>
          <option value="card">Cartão</option>
          <option value="cash">Dinheiro</option>
        </select>

        <div style="margin-top:12px">
          <button class="btn" type="submit">Pagar e Finalizar</button>
        </div>
      </form>

      <aside class="panel">
        <h3>Resumo do pedido</h3>
        <div class="checkout-list">
          {% if products %}
            {% for p in products %}
              <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f6f6f6">
                <div>
                  <div style="font-weight:700">{{ p.name_product }}</div>
                  <div class="muted">Qtd: {{ p.quantity }}</div>
                </div>
                <div style="text-align:right">
                  <div>R$ {{ p.total_price|floatformat:2 }}</div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="muted">Carrinho vazio.</p>
          {% endif %}
        </div>
        <div style="margin-top:12px;display:flex;justify-content:space-between;font-weight:700">
          <div>Total</div>
          <div>R$ {{ total|floatformat:2 }}</div>
        </div>
      </aside>

    </div>
  </div>

  <script>
    document.getElementById("checkoutForm").addEventListener("submit", function (e) {
      e.preventDefault();
      alert("✅ Pedido finalizado com sucesso! Obrigado pela sua compra.");
      this.submit();
    });
  </script>
</body>
</html>
